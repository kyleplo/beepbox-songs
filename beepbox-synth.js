// I created this to serve this file over HTTPS
var beepbox;(function(e){var n=function(){function c(d,g){this._bits=[],this._readIndex=0;for(var f,_=0;_<g.length;_++)f=d[g.charAt(_)],this._bits.push(0!=(32&f)),this._bits.push(0!=(16&f)),this._bits.push(0!=(8&f)),this._bits.push(0!=(4&f)),this._bits.push(0!=(2&f)),this._bits.push(0!=(1&f))}return c.prototype.read=function(d){for(var g=0;0<d;)g<<=1,g+=this._bits[this._readIndex++]?1:0,d--;return g},c.prototype.readLongTail=function(d,g){for(var _=d,f=g;this._bits[this._readIndex++];)_+=1<<f,f++;for(;0<f;)f--,this._bits[this._readIndex++]&&(_+=1<<f);return _},c.prototype.readPartDuration=function(){return this.readLongTail(1,2)},c.prototype.readPinCount=function(){return this.readLongTail(1,0)},c.prototype.readNoteInterval=function(){return this.read(1)?-this.readLongTail(1,3):this.readLongTail(1,3)},c}(),s=function(){function c(){this._bits=[]}return c.prototype.write=function(d,g){for(d--;0<=d;)this._bits.push(1==(1&g>>d)),d--},c.prototype.writeLongTail=function(d,g,_){if(_<d)throw new Error("value out of bounds");_-=d;for(var f=g;_>=1<<f;)this._bits.push(!0),_-=1<<f,f++;for(this._bits.push(!1);0<f;)f--,this._bits.push(0!=(_&1<<f))},c.prototype.writePartDuration=function(d){this.writeLongTail(1,2,d)},c.prototype.writePinCount=function(d){this.writeLongTail(1,0,d)},c.prototype.writeNoteInterval=function(d){0>d?(this.write(1,1),this.writeLongTail(1,3,-d)):(this.write(1,0),this.writeLongTail(1,3,d))},c.prototype.concat=function(d){this._bits=this._bits.concat(d._bits)},c.prototype.encodeBase64=function(d){for(var f,g="",_=0;_<this._bits.length;_+=6)f=0,this._bits[_+0]&&(f+=32),this._bits[_+1]&&(f+=16),this._bits[_+2]&&(f+=8),this._bits[_+3]&&(f+=4),this._bits[_+4]&&(f+=2),this._bits[_+5]&&(f+=1),g+=d[f];return g},c}(),a=function(){return function(){}}();a.scaleNames=["easy :)","easy :(","island :)","island :(","blues :)","blues :(","normal :)","normal :(","romani :)","romani :(","enigma","expert"],a.scaleFlags=[[!0,!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!1,!0,!1,!1,!0,!1],[!0,!1,!1,!1,!0,!0,!1,!0,!1,!1,!1,!0],[!0,!0,!1,!0,!1,!1,!1,!0,!0,!1,!1,!1],[!0,!1,!0,!0,!0,!1,!1,!0,!1,!0,!1,!1],[!0,!1,!1,!0,!1,!0,!0,!0,!1,!1,!0,!1],[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],[!0,!1,!0,!0,!1,!0,!1,!0,!0,!1,!0,!1],[!0,!0,!1,!1,!0,!0,!1,!0,!0,!1,!0,!1],[!0,!1,!0,!0,!1,!1,!0,!0,!0,!1,!1,!0],[!0,!1,!0,!1,!0,!1,!0,!1,!0,!1,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]],a.pianoScaleFlags=[!0,!1,!0,!1,!0,!0,!1,!0,!1,!0,!1,!0],a.blackKeyNameParents=[-1,1,-1,1,-1,1,-1,-1,1,-1,1,-1],a.noteNames=["C",null,"D",null,"E","F",null,"G",null,"A",null,"B"],a.keyNames=["B","A\xE2\u2122\xAF","A","G\xE2\u2122\xAF","G","F\xE2\u2122\xAF","F","E","D\xE2\u2122\xAF","D","C\xE2\u2122\xAF","C"],a.keyTransposes=[23,22,21,20,19,18,17,16,15,14,13,12],a.tempoNames=["molasses","slow","leisurely","moderate","steady","brisk","hasty","fast","strenuous","grueling","hyper","ludicrous"],a.reverbRange=4,a.beatsMin=3,a.beatsMax=15,a.barsMin=1,a.barsMax=128,a.patternsMin=1,a.patternsMax=64,a.instrumentsMin=1,a.instrumentsMax=10,a.partNames=["triples","standard"],a.partCounts=[3,4],a.waveNames=["triangle","square","pulse wide","pulse narrow","sawtooth","double saw","double pulse","spiky","plateau"],a.waveVolumes=[1,0.5,0.5,0.5,0.65,0.5,0.4,0.4,0.94],a.drumNames=["retro","white"],a.drumVolumes=[0.25,1],a.filterNames=["sustain sharp","sustain medium","sustain soft","decay sharp","decay medium","decay soft"],a.filterBases=[2,3.5,5,1,2.5,4],a.filterDecays=[0,0,0,10,7,4],a.filterVolumes=[0.4,0.7,1,0.5,0.75,1],a.attackNames=["binary","sudden","smooth","slide"],a.effectNames=["none","vibrato light","vibrato delayed","vibrato heavy","tremelo light","tremelo heavy"],a.effectVibratos=[0,0.15,0.3,0.45,0,0],a.effectTremelos=[0,0,0,0,0.25,0.5],a.chorusNames=["union","shimmer","hum","honky tonk","dissonant","fifths","octaves","bowed"],a.chorusValues=[0,0.02,0.05,0.1,0.25,3.5,6,0.02],a.chorusOffsets=[0,0,0,0,0,3.5,6,0],a.chorusVolumes=[0.7,0.8,1,1,0.9,0.9,0.8,1],a.volumeNames=["loudest","loud","medium","quiet","quietest","mute"],a.volumeValues=[0,0.5,1,1.5,2,-1],a.channelVolumes=[0.27,0.27,0.27,0.19],a.drumInterval=6,a.numChannels=4,a.drumCount=12,a.noteCount=37,a.maxPitch=84,e.Music=a;var r=function(){return function(d,g,_){this.interval=d,this.time=g,this.volume=_}}();e.TonePin=r;var o=function(){return function(d,g,_,f,b){void 0===b&&(b=!1),this.notes=[d],this.pins=[new r(0,0,f),new r(0,_-g,b?0:f)],this.start=g,this.end=_}}();e.Tone=o;var u=function(){function c(){this.tones=[],this.instrument=0}return c.prototype.cloneTones=function(){for(var d=[],g=0,_=this.tones;g<_.length;g++){var f=_[g],b=new o(-1,f.start,f.end,3);b.notes=f.notes.concat(),b.pins=[];for(var P,v=0,y=f.pins;v<y.length;v++)P=y[v],b.pins.push(new r(P.interval,P.time,P.volume));d.push(b)}return d},c}();e.BarPattern=u;var m=function(){function c(d){void 0===d&&(d=null),null==d?this.initToDefault():this.fromString(d)}return c.prototype.initToDefault=function(){this.channelPatterns=[[new u,new u,new u,new u,new u,new u,new u,new u],[new u,new u,new u,new u,new u,new u,new u,new u],[new u,new u,new u,new u,new u,new u,new u,new u],[new u,new u,new u,new u,new u,new u,new u,new u]],this.channelBars=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],this.channelOctaves=[3,2,1,0],this.instrumentVolumes=[[0],[0],[0],[0]],this.instrumentWaves=[[1],[1],[1],[1]],this.instrumentFilters=[[0],[0],[0],[0]],this.instrumentAttacks=[[1],[1],[1],[1]],this.instrumentEffects=[[0],[0],[0],[0]],this.instrumentChorus=[[0],[0],[0],[0]],this.scale=0,this.key=a.keyNames.length-1,this.loopStart=0,this.loopLength=4,this.tempo=7,this.reverb=0,this.beats=8,this.bars=16,this.patterns=8,this.parts=4,this.instruments=1},c.prototype.toString=function(){var d,g,_="",f=c._base64IntToChar;for(_+=f[c._latestVersion],_+="s"+f[this.scale],_+="k"+f[this.key],_+="l"+f[this.loopStart>>6]+f[63&this.loopStart],_+="e"+f[this.loopLength-1>>6]+f[63&this.loopLength-1],_+="t"+f[this.tempo],_+="m"+f[this.reverb],_+="a"+f[this.beats-1],_+="g"+f[this.bars-1>>6]+f[63&this.bars-1],_+="j"+f[this.patterns-1],_+="i"+f[this.instruments-1],_+="r"+f[a.partCounts.indexOf(this.parts)],_+="w",d=0;d<a.numChannels;d++)for(var b=0;b<this.instruments;b++)_+=f[this.instrumentWaves[d][b]];for(_+="f",d=0;d<a.numChannels;d++)for(var b=0;b<this.instruments;b++)_+=f[this.instrumentFilters[d][b]];for(_+="d",d=0;d<a.numChannels;d++)for(var b=0;b<this.instruments;b++)_+=f[this.instrumentAttacks[d][b]];for(_+="c",d=0;d<a.numChannels;d++)for(var b=0;b<this.instruments;b++)_+=f[this.instrumentEffects[d][b]];for(_+="h",d=0;d<a.numChannels;d++)for(var b=0;b<this.instruments;b++)_+=f[this.instrumentChorus[d][b]];for(_+="v",d=0;d<a.numChannels;d++)for(var b=0;b<this.instruments;b++)_+=f[this.instrumentVolumes[d][b]];for(_+="o",d=0;d<a.numChannels;d++)_+=f[this.channelOctaves[d]];_+="b",g=new s;for(var v=0;1<<v<this.patterns+1;)v++;for(d=0;d<a.numChannels;d++)for(var b=0;b<this.bars;b++)g.write(v,this.channelBars[d][b]);_+=g.encodeBase64(f),_+="p",g=new s;for(var y=0;1<<y<this.instruments;)y++;for(d=0;d<a.numChannels;d++){for(var P=3==d?0:12*this.channelOctaves[d],S=(3==d?4:12)+P,C=3==d?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],A=[],b=0;b<C.length;b++)C[b]+=P;for(var x,B=0,w=this.channelPatterns[d];B<w.length;B++)if(x=w[B],g.write(y,x.instrument),0<x.tones.length){g.write(1,1);for(var F,N=0,V=0,L=x.tones;V<L.length;V++){F=L[V],F.start>N&&(g.write(2,0),g.writePartDuration(F.start-N));for(var O=new s,b=1;b<F.notes.length;b++)O.write(1,1);4>F.notes.length&&O.write(1,0),O.writePinCount(F.pins.length-1),O.write(2,F.pins[0].volume);for(var I=0,T=F.notes[0],D=T,M=[],b=1;b<F.pins.length;b++){var W=F.pins[b],E=T+W.interval;D==E?O.write(1,0):(O.write(1,1),M.push(E),D=E),O.writePartDuration(W.time-I),I=W.time,O.write(2,W.volume)}var H=O.encodeBase64(f),q=A.indexOf(H);-1==q?(g.write(2,1),g.concat(O)):(g.write(1,1),g.writeLongTail(0,0,q),A.splice(q,1)),A.unshift(H),10<A.length&&A.pop();for(var R=F.notes.concat(M),b=0;b<R.length;b++){var G=R[b],J=C.indexOf(G);if(-1==J){var z=0,Y=S;if(Y<G)for(;Y!=G;)Y++,-1==C.indexOf(Y)&&z++;else for(;Y!=G;)Y--,-1==C.indexOf(Y)&&z--;g.write(1,0),g.writeNoteInterval(z)}else g.write(1,1),g.write(3,J),C.splice(J,1);C.unshift(G),8<C.length&&C.pop(),S=b==F.notes.length-1?F.notes[0]:G}N=F.end}N<this.beats*this.parts&&(g.write(2,0),g.writePartDuration(this.beats*this.parts-N))}else g.write(1,0)}for(var U=g.encodeBase64(f),K=U.length,X="";0<K;)X=f[63&K]+X,K>>=6;return _+=f[X.length],_+=X,_+=U,_},c.prototype.fromString=function(d){if(d=d.trim(),"#"==d.charAt(0)&&(d=d.substring(1)),null==d||0==d.length)return void this.initToDefault();if("{"==d.charAt(0))return void this.fromJsonObject(JSON.parse(d));this.initToDefault();var g=0,_=c._base64CharToInt[d.charAt(g++)];if(!(-1==_||_>c._latestVersion||_<c._oldestVersion)){var f=3>_,v=5>_,y=c._base64CharToInt;for(f&&(this.instrumentAttacks=[[0],[0],[0],[0]]),f&&(this.instrumentWaves=[[1],[1],[1],[0]]);g<d.length;){var P=d.charAt(g++),S=void 0;if("s"==P)this.scale=y[d.charAt(g++)],f&&10==this.scale&&(this.scale=11);else if("k"==P)this.key=y[d.charAt(g++)];else if("l"==P)this.loopStart=v?y[d.charAt(g++)]:(y[d.charAt(g++)]<<6)+y[d.charAt(g++)];else if("e"==P)this.loopLength=v?y[d.charAt(g++)]:(y[d.charAt(g++)]<<6)+y[d.charAt(g++)]+1;else if("t"==P)this.tempo=4>_?[1,4,7,10][y[d.charAt(g++)]]:y[d.charAt(g++)],this.tempo=this._clip(0,a.tempoNames.length,this.tempo);else if("m"==P)this.reverb=y[d.charAt(g++)],this.reverb=this._clip(0,a.reverbRange,this.reverb);else if("a"==P)this.beats=f?[6,7,8,9,10][y[d.charAt(g++)]]:y[d.charAt(g++)]+1,this.beats=Math.max(a.beatsMin,Math.min(a.beatsMax,this.beats));else if("g"==P)this.bars=(y[d.charAt(g++)]<<6)+y[d.charAt(g++)]+1,this.bars=Math.max(a.barsMin,Math.min(a.barsMax,this.bars));else if("j"==P)this.patterns=y[d.charAt(g++)]+1,this.patterns=Math.max(a.patternsMin,Math.min(a.patternsMax,this.patterns));else if("i"==P)this.instruments=y[d.charAt(g++)]+1,this.instruments=Math.max(a.instrumentsMin,Math.min(a.instrumentsMax,this.instruments));else if("r"==P)this.parts=a.partCounts[y[d.charAt(g++)]];else if("w"==P){if(f)S=y[d.charAt(g++)],this.instrumentWaves[S][0]=this._clip(0,a.waveNames.length,y[d.charAt(g++)]);else for(S=0;S<a.numChannels;S++)for(var C=0;C<this.instruments;C++)this.instrumentWaves[S][C]=this._clip(0,a.waveNames.length,y[d.charAt(g++)]);}else if("f"==P){if(f)S=y[d.charAt(g++)],this.instrumentFilters[S][0]=[0,2,3,5][this._clip(0,a.filterNames.length,y[d.charAt(g++)])];else for(S=0;S<a.numChannels;S++)for(var C=0;C<this.instruments;C++)this.instrumentFilters[S][C]=this._clip(0,a.filterNames.length,y[d.charAt(g++)]);}else if("d"==P){if(f)S=y[d.charAt(g++)],this.instrumentAttacks[S][0]=this._clip(0,a.attackNames.length,y[d.charAt(g++)]);else for(S=0;S<a.numChannels;S++)for(var C=0;C<this.instruments;C++)this.instrumentAttacks[S][C]=this._clip(0,a.attackNames.length,y[d.charAt(g++)]);}else if("c"==P){if(f)S=y[d.charAt(g++)],this.instrumentEffects[S][0]=this._clip(0,a.effectNames.length,y[d.charAt(g++)]),1==this.instrumentEffects[S][0]?this.instrumentEffects[S][0]=3:3==this.instrumentEffects[S][0]&&(this.instrumentEffects[S][0]=5);else for(S=0;S<a.numChannels;S++)for(var C=0;C<this.instruments;C++)this.instrumentEffects[S][C]=this._clip(0,a.effectNames.length,y[d.charAt(g++)]);}else if("h"==P){if(f)S=y[d.charAt(g++)],this.instrumentChorus[S][0]=this._clip(0,a.chorusNames.length,y[d.charAt(g++)]);else for(S=0;S<a.numChannels;S++)for(var C=0;C<this.instruments;C++)this.instrumentChorus[S][C]=this._clip(0,a.chorusNames.length,y[d.charAt(g++)]);}else if("v"==P){if(f)S=y[d.charAt(g++)],this.instrumentVolumes[S][0]=this._clip(0,a.volumeNames.length,y[d.charAt(g++)]);else for(S=0;S<a.numChannels;S++)for(var C=0;C<this.instruments;C++)this.instrumentVolumes[S][C]=this._clip(0,a.volumeNames.length,y[d.charAt(g++)]);}else if("o"==P){if(f)S=y[d.charAt(g++)],this.channelOctaves[S]=this._clip(0,5,y[d.charAt(g++)]);else for(S=0;S<a.numChannels;S++)this.channelOctaves[S]=this._clip(0,5,y[d.charAt(g++)]);}else if("b"==P){var A=void 0;if(f){S=y[d.charAt(g++)];var B=y[d.charAt(g++)];A=Math.ceil(0.5*B);for(var w=new n(y,d.substr(g,A)),C=0;C<B;C++)this.channelBars[S][C]=w.read(3)+1}else if(v){for(var x=0;1<<x<this.patterns;)x++;A=Math.ceil(a.numChannels*this.bars*x/6);var w=new n(y,d.substr(g,A));for(S=0;S<a.numChannels;S++){this.channelBars[S].length=this.bars;for(var C=0;C<this.bars;C++)this.channelBars[S][C]=w.read(x)+1}}else{for(var N=0;1<<N<this.patterns+1;)N++;A=Math.ceil(a.numChannels*this.bars*N/6);var w=new n(y,d.substr(g,A));for(S=0;S<a.numChannels;S++){this.channelBars[S].length=this.bars;for(var C=0;C<this.bars;C++)this.channelBars[S][C]=w.read(N)}}g+=A}else if("p"==P){var V=0;if(f)S=y[d.charAt(g++)],g++,V=y[d.charAt(g++)],V<<=6,V+=y[d.charAt(g++)];else{S=0;for(var L=y[d.charAt(g++)];0<L;)V<<=6,V+=y[d.charAt(g++)],L--}var w=new n(y,d.substr(g,V));g+=V;for(var F=0;1<<F<this.instruments;)F++;for(;;){this.channelPatterns[S]=[];for(var O=3==S?0:12*this.channelOctaves[S],I=null,T=null,D=(3==S?4:12)+O,M=3==S?[4,6,7,2,3,8,0,10]:[12,19,24,31,36,7,0],W=[],C=0;C<M.length;C++)M[C]+=O;for(var E,C=0;C<this.patterns;C++)if(E=new u,E.instrument=w.read(F),this.channelPatterns[S][C]=E,f||0!=w.read(1)){for(var H=0,q=[];H<this.beats*this.parts;){var R=1==w.read(1),G=!1,J=0;if(R?J=w.readLongTail(0,0):G=1==w.read(1),!R&&!G){var z=w.readPartDuration();H+=z}else{var Y=void 0,U=void 0,K=void 0;if(R)Y=W[J],W.splice(J,1);else{for(Y={},Y.noteCount=1;4>Y.noteCount&&1==w.read(1);)Y.noteCount++;Y.pinCount=w.readPinCount(),Y.initialVolume=w.read(2),Y.pins=[],Y.length=0,Y.bendCount=0;for(var X=0;X<Y.pinCount;X++)U={},U.pitchBend=1==w.read(1),U.pitchBend&&Y.bendCount++,Y.length+=w.readPartDuration(),U.time=Y.length,U.volume=w.read(2),Y.pins.push(U)}W.unshift(Y),10<W.length&&W.pop(),I=new o(0,H,H+Y.length,Y.initialVolume),I.notes=[],I.pins.length=1;for(var Q,Z=[],X=0;X<Y.noteCount+Y.bendCount;X++){if(Q=1==w.read(1),!Q){var $=w.readNoteInterval();K=D;for(var ee=$;0<ee;){for(K++;-1!=M.indexOf(K);)K++;ee--}for(;0>ee;){for(K--;-1!=M.indexOf(K);)K--;ee++}}else{var te=w.read(3);K=M[te],M.splice(te,1)}M.unshift(K),8<M.length&&M.pop(),X<Y.noteCount?I.notes.push(K):Z.push(K),D=X==Y.noteCount-1?I.notes[0]:K}Z.unshift(I.notes[0]);for(var ae,ne=0,se=Y.pins;ne<se.length;ne++)ae=se[ne],ae.pitchBend&&Z.shift(),T=new r(Z[0]-I.notes[0],ae.time,ae.volume),I.pins.push(T);H=I.end,q.push(I)}}E.tones=q}if(f)break;else if(S++,S>=a.numChannels)break}}}}},c.prototype.toJsonObject=function(d,g,_){void 0===d&&(d=!0),void 0===g&&(g=1),void 0===_&&(_=!0);for(var v,f=[],b=0;b<a.numChannels;b++){v=[];for(var y=0;y<this.instruments;y++)3==b?v.push({volume:20*(5-this.instrumentVolumes[b][y]),wave:a.drumNames[this.instrumentWaves[b][y]],envelope:a.attackNames[this.instrumentAttacks[b][y]]}):v.push({volume:20*(5-this.instrumentVolumes[b][y]),wave:a.waveNames[this.instrumentWaves[b][y]],envelope:a.attackNames[this.instrumentAttacks[b][y]],filter:a.filterNames[this.instrumentFilters[b][y]],chorus:a.chorusNames[this.instrumentChorus[b][y]],effect:a.effectNames[this.instrumentEffects[b][y]]});for(var P=[],S=0,C=this.channelPatterns[b];S<C.length;S++){for(var A=C[S],B=[],w=0,x=A.tones;w<x.length;w++){for(var O,N=x[w],V=[],L=0,F=N.pins;L<F.length;L++)O=F[L],V.push({tick:O.time+N.start,pitchBend:O.interval,volume:Math.round(100*O.volume/3)});B.push({pitches:N.notes,points:V})}P.push({instrument:A.instrument+1,notes:B})}var I=[];if(d)for(var y=0;y<this.loopStart;y++)I.push(this.channelBars[b][y]);for(var T=0;T<g;T++)for(var y=this.loopStart;y<this.loopStart+this.loopLength;y++)I.push(this.channelBars[b][y]);if(_)for(var y=this.loopStart+this.loopLength;y<this.bars;y++)I.push(this.channelBars[b][y]);f.push({octaveScrollBar:this.channelOctaves[b],instruments:v,patterns:P,sequence:I})}return{version:c._latestVersion,scale:a.scaleNames[this.scale],key:a.keyNames[this.key],introBars:this.loopStart,loopBars:this.loopLength,beatsPerBar:this.beats,ticksPerBeat:this.parts,beatsPerMinute:this.getBeatsPerMinute(),reverb:this.reverb,channels:f}},c.prototype.fromJsonObject=function(d){if(this.initToDefault(),!!d){var g=d.version;if(5===g){if(this.scale=11,void 0!=d.scale){var _=a.scaleNames.indexOf(d.scale);-1!=_&&(this.scale=_)}if(void 0!=d.key)if("number"==typeof d.key)this.key=a.keyNames.length-1-(d.key+1200>>>0)%a.keyNames.length;else if("string"==typeof d.key){var f=d.key,b=f.charAt(0).toUpperCase(),v=f.charAt(1).toLowerCase(),S={C:11,D:9,E:7,F:6,G:4,A:2,B:0}[b],C={"#":-1,"\xE2\u2122\xAF":-1,b:1,"\xE2\u2122\xAD":1}[v];void 0!=S&&(void 0!=C&&(S+=C),0>S&&(S+=12),S%=12,this.key=S)}if(void 0!=d.beatsPerMinute){var A=0|d.beatsPerMinute;this.tempo=Math.round(4+9*Math.log(A/120)/Math.LN2),this.tempo=this._clip(0,a.tempoNames.length,this.tempo)}void 0!=d.reverb&&(this.reverb=this._clip(0,a.reverbRange,0|d.reverb)),void 0!=d.beatsPerBar&&(this.beats=Math.max(a.beatsMin,Math.min(a.beatsMax,0|d.beatsPerBar))),void 0!=d.ticksPerBeat&&(this.parts=Math.max(3,Math.min(4,0|d.ticksPerBeat)));for(var B=1,w=1,x=1,N=0;N<a.numChannels;N++)if(d.channels&&d.channels[N]){var V=d.channels[N];V.instruments&&(B=Math.max(B,0|V.instruments.length)),V.patterns&&(w=Math.max(w,0|V.patterns.length)),V.sequence&&(x=Math.max(x,0|V.sequence.length))}this.instruments=B,this.patterns=w,this.bars=x,void 0!=d.introBars&&(this.loopStart=this._clip(0,this.bars,0|d.introBars)),void 0!=d.loopBars&&(this.loopLength=this._clip(1,this.bars-this.loopStart+1,0|d.loopBars));for(var V,N=0;N<a.numChannels;N++){V=void 0,d.channels&&(V=d.channels[N]),void 0==V&&(V={}),void 0!=V.octaveScrollBar&&(this.channelOctaves[N]=this._clip(0,5,0|V.octaveScrollBar)),this.instrumentVolumes[N].length=this.instruments,this.instrumentWaves[N].length=this.instruments,this.instrumentAttacks[N].length=this.instruments,this.instrumentFilters[N].length=this.instruments,this.instrumentChorus[N].length=this.instruments,this.instrumentEffects[N].length=this.instruments,this.channelPatterns[N].length=this.patterns,this.channelBars[N].length=this.bars;for(var F,L=0;L<this.instruments;L++)F=void 0,V.instruments&&(F=V.instruments[L]),void 0==F&&(F={}),this.instrumentVolumes[N][L]=void 0==F.volume?0:this._clip(0,a.volumeNames.length,Math.round(5-(0|F.volume)/20)),this.instrumentAttacks[N][L]=a.attackNames.indexOf(F.envelope),-1==this.instrumentAttacks[N][L]&&(this.instrumentAttacks[N][L]=1),3==N?(this.instrumentWaves[N][L]=a.drumNames.indexOf(F.wave),-1==this.instrumentWaves[N][L]&&(this.instrumentWaves[N][L]=0),this.instrumentFilters[N][L]=0,this.instrumentChorus[N][L]=0,this.instrumentEffects[N][L]=0):(this.instrumentWaves[N][L]=a.waveNames.indexOf(F.wave),-1==this.instrumentWaves[N][L]&&(this.instrumentWaves[N][L]=1),this.instrumentFilters[N][L]=a.filterNames.indexOf(F.filter),-1==this.instrumentFilters[N][L]&&(this.instrumentFilters[N][L]=0),this.instrumentChorus[N][L]=a.chorusNames.indexOf(F.chorus),-1==this.instrumentChorus[N][L]&&(this.instrumentChorus[N][L]=0),this.instrumentEffects[N][L]=a.effectNames.indexOf(F.effect),-1==this.instrumentEffects[N][L]&&(this.instrumentEffects[N][L]=0));for(var O,L=0;L<this.patterns;L++){O=new u,this.channelPatterns[N][L]=O;var I=void 0;if(V.patterns&&(I=V.patterns[L]),void 0!=I&&(O.instrument=this._clip(0,this.instruments,(0|I.instrument)-1),I.notes&&0<I.notes.length))for(var W,T=Math.min(this.beats*this.parts,I.notes.length>>>0),D=0,M=0;M<I.notes.length&&!(M>=T);M++)if(W=I.notes[M],W&&W.pitches&&1<=W.pitches.length&&W.points&&2<=W.points.length){var E=new o(0,0,0,0);E.notes=[],E.pins=[];for(var q,H=0;H<W.pitches.length&&(q=0|W.pitches[H],!(-1==E.notes.indexOf(q)&&(E.notes.push(q),4<=E.notes.length)));H++);if(!(1>E.notes.length)){for(var J,R=D,G=0,H=0;H<W.points.length;H++)if(J=W.points[H],void 0!=J&&void 0!=J.tick){var z=void 0==J.pitchBend?0:0|J.pitchBend,Y=0|J.tick,U=void 0==J.volume?3:Math.max(0,Math.min(3,Math.round(3*(0|J.volume)/100)));if(!(Y>this.beats*this.parts)){if(0==E.pins.length){if(Y<R)continue;E.start=Y,G=z}else if(Y<=R)continue;R=Y,E.pins.push(new r(z-G,Y-E.start,U))}}if(!(2>E.pins.length)){E.end=E.pins[E.pins.length-1].time+E.start;for(var K=3==N?a.drumCount-1:a.maxPitch,X=K,Z=0,H=0;H<E.notes.length;H++)E.notes[H]+=G,(0>E.notes[H]||E.notes[H]>K)&&(E.notes.splice(H,1),H--),E.notes[H]<X&&(X=E.notes[H]),E.notes[H]>Z&&(Z=E.notes[H]);if(!(1>E.notes.length)){for(var Q,H=0;H<E.pins.length;H++)Q=E.pins[H],0>Q.interval+X&&(Q.interval=-X),Q.interval+Z>K&&(Q.interval=K-Z),2<=H&&Q.interval==E.pins[H-1].interval&&Q.interval==E.pins[H-2].interval&&Q.volume==E.pins[H-1].volume&&Q.volume==E.pins[H-2].volume&&(E.pins.splice(H-1,1),H--);O.tones.push(E),D=E.end}}}}}for(var L=0;L<this.bars;L++)this.channelBars[N][L]=V.sequence?Math.min(this.patterns,V.sequence[L]>>>0):0}}}},c.prototype._clip=function(d,g,_){return--g,_<=g?_>=d?_:d:g},c.prototype.getPattern=function(d,g){var _=this.channelBars[d][g];return 0==_?null:this.channelPatterns[d][_-1]},c.prototype.getPatternInstrument=function(d,g){var _=this.getPattern(d,g);return null==_?0:_.instrument},c.prototype.getBeatsPerMinute=function(){return Math.round(120*Math.pow(2,(-4+this.tempo)/9))},c}();m._oldestVersion=2,m._latestVersion=5,m._base64CharToInt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35,A:36,B:37,C:38,D:39,E:40,F:41,G:42,H:43,I:44,J:45,K:46,L:47,M:48,N:49,O:50,P:51,Q:52,R:53,S:54,T:55,U:56,V:57,W:58,X:59,Y:60,Z:61,"-":62,".":62,_:63},m._base64IntToChar=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","_"],e.Song=m;var h=function(){function c(d){void 0===d&&(d=null),this.samplesPerSecond=44100,this._effectDuration=0.14,this._effectAngle=2*Math.PI/(this._effectDuration*this.samplesPerSecond),this._effectYMult=2*Math.cos(this._effectAngle),this._limitDecay=1/(2*this.samplesPerSecond),this._waves=[new Float64Array([0.06666666666666667,0.2,0.3333333333333333,0.4666666666666667,0.6,0.7333333333333333,0.8666666666666667,1,1,0.8666666666666667,0.7333333333333333,0.6,0.4666666666666667,0.3333333333333333,0.2,0.06666666666666667,-0.06666666666666667,-0.2,-0.3333333333333333,-0.4666666666666667,-0.6,-0.7333333333333333,-0.8666666666666667,-1,-1,-0.8666666666666667,-0.7333333333333333,-0.6,-0.4666666666666667,-0.3333333333333333,-0.2,-0.06666666666666667]),new Float64Array([1,-1]),new Float64Array([1,-1,-1,-1]),new Float64Array([1,-1,-1,-1,-1,-1,-1,-1]),new Float64Array([0.03225806451612903,0.0967741935483871,0.16129032258064516,0.22580645161290322,0.2903225806451613,0.3548387096774194,0.41935483870967744,0.4838709677419355,0.5483870967741935,0.6129032258064516,0.6774193548387096,0.7419354838709677,0.8064516129032258,0.8709677419354839,0.9354838709677419,1,-1,-0.9354838709677419,-0.8709677419354839,-0.8064516129032258,-0.7419354838709677,-0.6774193548387096,-0.6129032258064516,-0.5483870967741935,-0.4838709677419355,-0.41935483870967744,-0.3548387096774194,-0.2903225806451613,-0.22580645161290322,-0.16129032258064516,-0.0967741935483871,-0.03225806451612903]),new Float64Array([0,-0.2,-0.4,-0.6,-0.8,-1,1,-0.8,-0.6,-0.4,-0.2,1,0.8,0.6,0.4,0.2]),new Float64Array([1,1,1,1,1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1]),new Float64Array([1,-1,1,-1,1,0]),new Float64Array([0,0.2,0.4,0.5,0.6,0.7,0.8,0.85,0.9,0.95,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.95,0.9,0.85,0.8,0.7,0.6,0.5,0.4,0.2,0,-0.2,-0.4,-0.5,-0.6,-0.7,-0.8,-0.85,-0.9,-0.95,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-0.95,-0.9,-0.85,-0.8,-0.7,-0.6,-0.5,-0.4,-0.2])],this._drumWaves=[new Float32Array(32767),new Float32Array(32767)],this.song=null,this.stutterPressed=!1,this.pianoPressed=!1,this.pianoNote=0,this.pianoChannel=0,this.enableIntro=!0,this.enableOutro=!1,this.loopCount=-1,this.volume=1,this._playhead=0,this._bar=0,this._beat=0,this._part=0,this._arpeggio=0,this._arpeggioSamples=0,this._paused=!0,this._leadPeriodA=0,this._leadPeriodB=0,this._leadSample=0,this._harmonyPeriodA=0,this._harmonyPeriodB=0,this._harmonySample=0,this._bassPeriodA=0,this._bassPeriodB=0,this._bassSample=0,this._drumPeriod=0,this._drumSample=0,this._drumSignal=1,this._stillGoing=!1,this._effectPeriod=0,this._limit=0,this._delayLine=new Float32Array(16384),this._delayPos=0,this._delayFeedback0=0,this._delayFeedback1=0,this._delayFeedback2=0,this._delayFeedback3=0;for(var g=0,_=this._waves;g<_.length;g++){for(var f=_[g],b=0,v=0;v<f.length;v++)b+=f[v];for(var y=b/f.length,v=0;v<f.length;v++)f[v]-=y}for(var f,P=0;P<this._drumWaves.length;P++)if(f=this._drumWaves[P],0==P)for(var S=1,v=0;32767>v;v++){f[v]=2*(1&S)-1;var C=S>>1;1==(1&S+C)&&(C+=16384),S=C}else if(1==P)for(var v=0;32767>v;v++)f[v]=2*Math.random()-1;null!=d&&this.setSong(d)}return Object.defineProperty(c.prototype,"playing",{get:function(){return!this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"playhead",{get:function(){return this._playhead},set:function(d){if(null!=this.song){this._playhead=Math.max(0,Math.min(this.song.bars,d));var g=this._playhead;this._bar=Math.floor(g),g=this.song.beats*(g-this._bar),this._beat=Math.floor(g),g=this.song.parts*(g-this._beat),this._part=Math.floor(g),g=4*(g-this._part),this._arpeggio=Math.floor(g);var _=this._getSamplesPerArpeggio();g=_*(g-this._arpeggio),this._arpeggioSamples=Math.floor(_-g),this._bar<this.song.loopStart&&(this.enableIntro=!0),this._bar>this.song.loopStart+this.song.loopLength&&(this.enableOutro=!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"totalSamples",{get:function(){if(null==this.song)return 0;var d=4*this._getSamplesPerArpeggio()*this.song.parts*this.song.beats,g=this.loopCount;0>g&&(g=1);var _=this.song.loopLength*g;return this.enableIntro&&(_+=this.song.loopStart),this.enableOutro&&(_+=this.song.bars-(this.song.loopStart+this.song.loopLength)),_*d},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"totalSeconds",{get:function(){return this.totalSamples/this.samplesPerSecond},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"totalBars",{get:function(){return null==this.song?0:this.song.bars},enumerable:!0,configurable:!0}),c.prototype.setSong=function(d){"string"==typeof d?this.song=new m(d):d instanceof m&&(this.song=d)},c.prototype.play=function(){if(this._paused){this._paused=!1;var d=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;this._audioCtx=this._audioCtx||new d,this._scriptNode=this._audioCtx.createScriptProcessor?this._audioCtx.createScriptProcessor(2048,0,1):this._audioCtx.createJavaScriptNode(2048,0,1),this._scriptNode.onaudioprocess=this._onSampleData.bind(this),this._scriptNode.channelCountMode="explicit",this._scriptNode.channelInterpretation="speakers",this._scriptNode.connect(this._audioCtx.destination),this.samplesPerSecond=this._audioCtx.sampleRate,this._effectAngle=2*Math.PI/(this._effectDuration*this.samplesPerSecond),this._effectYMult=2*Math.cos(this._effectAngle),this._limitDecay=1/(2*this.samplesPerSecond)}},c.prototype.pause=function(){this._paused||(this._paused=!0,this._scriptNode.disconnect(this._audioCtx.destination),this._audioCtx.close&&(this._audioCtx.close(),this._audioCtx=null),this._scriptNode=null)},c.prototype.snapToStart=function(){this._bar=0,this.enableIntro=!0,this.snapToBar()},c.prototype.snapToBar=function(){this._playhead=this._bar,this._beat=0,this._part=0,this._arpeggio=0,this._arpeggioSamples=0,this._effectPeriod=0,this._leadSample=0,this._harmonySample=0,this._bassSample=0,this._drumSample=0,this._delayPos=0,this._delayFeedback0=0,this._delayFeedback1=0,this._delayFeedback2=0,this._delayFeedback3=0;for(var d=0;d<this._delayLine.length;d++)this._delayLine[d]=0},c.prototype.nextBar=function(){var d=this._bar;this._bar++,this.enableOutro?this._bar>=this.song.bars&&(this._bar=this.enableIntro?0:this.song.loopStart):(this._bar>=this.song.loopStart+this.song.loopLength||this._bar>=this.song.bars)&&(this._bar=this.song.loopStart),this._playhead+=this._bar-d},c.prototype.prevBar=function(){var d=this._bar;this._bar--,0>this._bar&&(this._bar=this.song.loopStart+this.song.loopLength-1),this._bar>=this.song.bars&&(this._bar=this.song.bars-1),this._bar<this.song.loopStart&&(this.enableIntro=!0),!this.enableOutro&&this._bar>=this.song.loopStart+this.song.loopLength&&(this._bar=this.song.loopStart+this.song.loopLength-1),this._playhead+=this._bar-d},c.prototype._onSampleData=function(d){var g=d.outputBuffer,_=g.getChannelData(0);this.synthesize(_,g.length)},c.prototype.synthesize=function(d,g){var _=this;if(null==this.song){for(var f=0;f<g;f++)d[f]=0;return}var v,b=0;if(this.stutterPressed){var y=this._bar,P=this._beat,S=this._part,C=this._arpeggio,A=this._arpeggioSamples,B=this._leadPeriodA,w=this._leadPeriodB,x=this._leadSample,N=this._harmonyPeriodA,V=this._harmonyPeriodB,L=this._harmonySample,F=this._bassPeriodA,O=this._bassPeriodB,I=this._bassSample,T=this._drumPeriod,D=this._drumSample,M=this._drumSignal,W=this._effectPeriod,E=this._limit;v=function(){_._bar=y,_._beat=P,_._part=S,_._arpeggio=C,_._arpeggioSamples=A,_._leadPeriodA=B,_._leadPeriodB=w,_._leadSample=x,_._harmonyPeriodA=N,_._harmonyPeriodB=V,_._harmonySample=L,_._bassPeriodA=F,_._bassPeriodB=O,_._bassSample=I,_._drumPeriod=T,_._drumSample=D,_._drumSignal=M,_._effectPeriod=W,_._limit=E}}var H=1/this.samplesPerSecond,q=this._getSamplesPerArpeggio(),R=this._effectYMult,G=this._limitDecay,J=this.volume,z=this._delayLine,Y=0.425*Math.pow(this.song.reverb/a.reverbRange,0.667),U=!1;(0==this._arpeggioSamples||this._arpeggioSamples>q)&&(this._arpeggioSamples=q),this._part>=this.song.parts&&(this._beat++,this._part=0,this._arpeggio=0,this._arpeggioSamples=q),this._beat>=this.song.beats&&(this._bar++,this._beat=0,this._part=0,this._arpeggio=0,this._arpeggioSamples=q,-1==this.loopCount&&(this._bar<this.song.loopStart&&!this.enableIntro&&(this._bar=this.song.loopStart),this._bar>=this.song.loopStart+this.song.loopLength&&!this.enableOutro&&(this._bar=this.song.loopStart))),this._bar>=this.song.bars&&(this.enableOutro?(this._bar=0,this.enableIntro=!0,U=!0,this.pause()):this._bar=this.song.loopStart),this._bar>=this.song.loopStart&&(this.enableIntro=!1);var K,X,Z,Q,$,ee,te,ne,se,ae,re,oe,ie,le,ue,me,pe,he,ce,de,ge,fe,be,ve,ye,Pe,Se,Ce=function(){var Tn=_.song.getPatternInstrument(0,_._bar),Dn=_.song.getPatternInstrument(1,_._bar),Mn=_.song.getPatternInstrument(2,_._bar),Wn=_.song.getPatternInstrument(3,_._bar);K=0.5*(a.channelVolumes[0]*(5==_.song.instrumentVolumes[0][Tn]?0:Math.pow(2,-a.volumeValues[_.song.instrumentVolumes[0][Tn]]))*a.waveVolumes[_.song.instrumentWaves[0][Tn]]*a.filterVolumes[_.song.instrumentFilters[0][Tn]]*a.chorusVolumes[_.song.instrumentChorus[0][Tn]]),X=0.5*(a.channelVolumes[1]*(5==_.song.instrumentVolumes[1][Dn]?0:Math.pow(2,-a.volumeValues[_.song.instrumentVolumes[1][Dn]]))*a.waveVolumes[_.song.instrumentWaves[1][Dn]]*a.filterVolumes[_.song.instrumentFilters[1][Dn]]*a.chorusVolumes[_.song.instrumentChorus[0][Dn]]),Z=0.5*(a.channelVolumes[2]*(5==_.song.instrumentVolumes[2][Mn]?0:Math.pow(2,-a.volumeValues[_.song.instrumentVolumes[2][Mn]]))*a.waveVolumes[_.song.instrumentWaves[2][Mn]]*a.filterVolumes[_.song.instrumentFilters[2][Mn]]*a.chorusVolumes[_.song.instrumentChorus[0][Mn]]),Q=a.channelVolumes[3]*(5==_.song.instrumentVolumes[3][Wn]?0:Math.pow(2,-a.volumeValues[_.song.instrumentVolumes[3][Wn]]))*a.drumVolumes[_.song.instrumentWaves[3][Wn]],$=_._waves[_.song.instrumentWaves[0][Tn]],ee=_._waves[_.song.instrumentWaves[1][Dn]],te=_._waves[_.song.instrumentWaves[2][Mn]],ne=_._drumWaves[_.song.instrumentWaves[3][Wn]],se=$.length,ae=ee.length,re=te.length,oe=Math.pow(2,-a.filterBases[_.song.instrumentFilters[0][Tn]]),ie=Math.pow(2,-a.filterBases[_.song.instrumentFilters[1][Dn]]),le=Math.pow(2,-a.filterBases[_.song.instrumentFilters[2][Mn]]),ue=1,me=a.effectTremelos[_.song.instrumentEffects[0][Tn]],pe=a.effectTremelos[_.song.instrumentEffects[1][Dn]],he=a.effectTremelos[_.song.instrumentEffects[2][Mn]],ce=Math.pow(2,(a.chorusOffsets[_.song.instrumentChorus[0][Tn]]+a.chorusValues[_.song.instrumentChorus[0][Tn]])/12),de=Math.pow(2,(a.chorusOffsets[_.song.instrumentChorus[1][Dn]]+a.chorusValues[_.song.instrumentChorus[1][Dn]])/12),ge=Math.pow(2,(a.chorusOffsets[_.song.instrumentChorus[2][Mn]]+a.chorusValues[_.song.instrumentChorus[2][Mn]])/12),fe=Math.pow(2,(a.chorusOffsets[_.song.instrumentChorus[0][Tn]]-a.chorusValues[_.song.instrumentChorus[0][Tn]])/12),be=Math.pow(2,(a.chorusOffsets[_.song.instrumentChorus[1][Dn]]-a.chorusValues[_.song.instrumentChorus[1][Dn]])/12),ve=Math.pow(2,(a.chorusOffsets[_.song.instrumentChorus[2][Mn]]-a.chorusValues[_.song.instrumentChorus[2][Mn]])/12),ye=7==_.song.instrumentChorus[0][Tn]?-1:1,Pe=7==_.song.instrumentChorus[1][Dn]?-1:1,Se=7==_.song.instrumentChorus[2][Mn]?-1:1,0==_.song.instrumentChorus[0][Tn]&&(_._leadPeriodB=_._leadPeriodA),0==_.song.instrumentChorus[1][Dn]&&(_._harmonyPeriodB=_._harmonyPeriodA),0==_.song.instrumentChorus[2][Mn]&&(_._bassPeriodB=_._bassPeriodA)};for(Ce();0<g;){if(U){for(console.log("ended");0<g--;)d[b]=0,b++;break}var Ae=void 0;Ae=this._arpeggioSamples<=g?this._arpeggioSamples:g,g-=Ae,this._arpeggioSamples-=Ae;for(var Be,we,ke,xe,Ne,Ve,Le,Fe,Oe,Ie,Te,De,Me,We,Ee,He,qe,je,Re,Ge,Je,ze,Ye,Ue,Ke,Xe=this._part+this._beat*this.song.parts,Ze=0;4>Ze;Ze++){var Qe=this.song.getPattern(Ze,this._bar),$e=null==Qe?0:this.song.instrumentAttacks[Ze][Qe.instrument],et=null,tt=null,nt=null;if(null!=Qe)for(var f=0;f<Qe.tones.length;f++)if(Qe.tones[f].end<=Xe)tt=Qe.tones[f];else if(Qe.tones[f].start<=Xe&&Qe.tones[f].end>Xe)et=Qe.tones[f];else if(Qe.tones[f].start>Xe){nt=Qe.tones[f];break}null!=et&&null!=tt&&tt.end!=et.start&&(tt=null),null!=et&&null!=nt&&nt.start!=et.end&&(nt=null);var st=3==Ze?69:a.keyTransposes[this.song.key],at=3==Ze?a.drumInterval:1,rt=void 0,ot=void 0,it=void 0,lt=void 0,ut=void 0,mt=void 0,pt=void 0,ht=!1;if(this.pianoPressed&&Ze==this.pianoChannel){var ct=this._frequencyFromPitch(st+this.pianoNote*at),dt=void 0;3==Ze?0<this.song.instrumentWaves[3][Qe.instrument]?(ue=Math.min(1,8*(ct*H)),dt=24):dt=60:dt=48,rt=ct*H,ot=1,it=Math.pow(2,-this.pianoNote*at/dt),lt=0,ut=1,mt=1,pt=Math.pow(2,a.effectVibratos[this.song.instrumentEffects[Ze][Qe.instrument]]/12)-1}else if(null==et)rt=0,ot=0,it=0,lt=0,ut=1,mt=1,pt=0,ht=!0;else{var gt=void 0;gt=2==et.notes.length?et.notes[this._arpeggio>>1]:3==et.notes.length?et.notes[3==this._arpeggio?1:this._arpeggio]:4==et.notes.length?et.notes[this._arpeggio]:et.notes[0];for(var yt,_t=null,ft=null,bt=0,vt=et.pins;bt<vt.length;bt++)if(yt=vt[bt],yt.time+et.start<=Xe)_t=yt;else{ft=yt;break}var Pt=4*et.start,St=4*et.end,Ct=4*(et.start+_t.time),At=4*(et.start+ft.time),Bt=4*Xe+this._arpeggio,wt=4*Xe+this._arpeggio+1,kt=(Bt-Ct)/(At-Ct),xt=(wt-Ct)/(At-Ct),Nt=_t.volume*(1-kt)+ft.volume*kt,Vt=_t.volume*(1-xt)+ft.volume*xt,Lt=_t.interval*(1-kt)+ft.interval*kt,Ft=_t.interval*(1-xt)+ft.interval*xt,Ot=_t.time*(1-kt)+ft.time*kt,It=_t.time*(1-xt)+ft.time*xt,Tt=!1;Bt==Pt&&(0==$e?Tt=!0:2==$e?Nt=0:3==$e&&(null==tt||1<tt.notes.length||1<et.notes.length?Nt=0:0==tt.pins[tt.pins.length-1].volume||0==et.pins[0].volume?Nt=0:(Lt=0.5*(tt.notes[0]+tt.pins[tt.pins.length-1].interval-gt),Ot=0.5*tt.pins[tt.pins.length-1].time,Tt=!0))),wt==St&&(1==$e||2==$e?Vt=0:3==$e&&(null==nt||1<nt.notes.length||1<et.notes.length?Vt=0:0==et.pins[et.pins.length-1].volume||0==nt.pins[0].volume?Nt=0:(Ft=0.5*(nt.notes[0]+et.pins[et.pins.length-1].interval-gt),It*=0.5)));var Dt=1-(this._arpeggioSamples+Ae)/q,Mt=1-this._arpeggioSamples/q,Wt=Lt*(1-Dt)+Ft*Dt,Et=Lt*(1-Mt)+Ft*Mt,Ht=Ot*(1-Dt)+It*Dt,qt=Ot*(1-Mt)+It*Mt,jt=this._frequencyFromPitch(st+(gt+Wt)*at),Rt=this._frequencyFromPitch(st+(gt+Et)*at),Gt=void 0;3==Ze?0<this.song.instrumentWaves[3][Qe.instrument]?(ue=Math.min(1,8*(jt*H)),Gt=24):Gt=60:Gt=48;var Jt=Math.pow(2,-(gt+Wt)*at/Gt),zt=Math.pow(2,-(gt+Et)*at/Gt);Jt*=this._volumeConversion(Nt*(1-Dt)+Vt*Dt),zt*=this._volumeConversion(Nt*(1-Mt)+Vt*Mt);rt=jt*H,ot=Math.pow(Rt/jt,1/Ae),it=Jt,lt=(zt-Jt)/Ae;var Ut=(Bt+Dt-Pt)*q/this.samplesPerSecond;0!=Ut||Tt||(ht=!0);var Kt=a.filterDecays[this.song.instrumentFilters[Ze][Qe.instrument]];ut=Math.pow(2,4*(-Kt*Ht)*q/this.samplesPerSecond);var Xt=Math.pow(2,4*(-Kt*qt)*q/this.samplesPerSecond);mt=Math.pow(Xt/ut,1/Ae),pt=2==this.song.instrumentEffects[Ze][Qe.instrument]&&3>Xe-et.start?0:Math.pow(2,a.effectVibratos[this.song.instrumentEffects[Ze][Qe.instrument]]/12)-1}0==Ze?(Be=rt,we=ot,ke=it*K,xe=lt*K,Ne=ut*oe,Ve=mt,Le=pt,ht&&(this._leadSample=0,this._leadPeriodA=0,this._leadPeriodB=0)):1==Ze?(Fe=rt,Oe=ot,Ie=it*X,Te=lt*X,De=ut*ie,Me=mt,We=pt,ht&&(this._harmonySample=0,this._harmonyPeriodA=0,this._harmonyPeriodB=0)):2==Ze?(Ee=rt,He=ot,qe=it*Z,je=lt*Z,Re=ut*le,Ge=mt,Je=pt,ht&&(this._bassSample=0,this._bassPeriodA=0,this._bassPeriodB=0)):3==Ze&&(ze=rt/32767,Ye=ot,Ue=it*Q,Ke=lt*Q)}for(var Zt=Math.sin(this._effectPeriod),Qt=Math.sin(this._effectPeriod-this._effectAngle),$t=+this._leadSample,en=+this._leadPeriodA,tn=+this._leadPeriodB,nn=+this._harmonySample,sn=+this._harmonyPeriodA,an=+this._harmonyPeriodB,rn=+this._bassSample,on=+this._bassPeriodA,ln=+this._bassPeriodB,un=+this._drumSample,mn=+this._drumPeriod,pn=0|this._delayPos,hn=+this._delayFeedback0,cn=+this._delayFeedback1,dn=+this._delayFeedback2,gn=+this._delayFeedback3,_n=+this._limit;Ae;){var fn=1+Le*Zt,bn=1+We*Zt,vn=1+Je*Zt,yn=1+me*(Zt-1),Pn=1+pe*(Zt-1),Sn=1+he*(Zt-1),Cn=Zt;Zt=R*Zt-Qt,Qt=Cn,$t+=(($[0|en*se]+$[0|tn*se]*ye)*ke*yn-$t)*Ne,nn+=((ee[0|sn*ae]+ee[0|an*ae]*Pe)*Ie*Pn-nn)*De,rn+=((te[0|on*re]+te[0|ln*re]*Se)*qe*Sn-rn)*Re,un+=(ne[0|32767*mn]*Ue-un)*ue,ke+=xe,Ie+=Te,qe+=je,Ue+=Ke,en+=Be*fn*ce,tn+=Be*fn*fe,sn+=Fe*bn*de,an+=Fe*bn*be,on+=Ee*vn*ge,ln+=Ee*vn*ve,mn+=ze,Be*=we,Fe*=Oe,Ee*=He,ze*=Ye,Ne*=Ve,De*=Me,Re*=Ge,en-=0|en,tn-=0|tn,sn-=0|sn,an-=0|an,on-=0|on,ln-=0|ln,mn-=0|mn;var An=$t+nn+rn,Bn=z[pn]+An,wn=z[16383&pn+3041],kn=z[16383&pn+6426],xn=z[16383&pn+10907],Nn=-Bn+wn,Vn=-Bn-wn,Ln=-kn+xn,Fn=-kn-xn;hn+=0.5*((Nn+Ln)*Y-hn),cn+=0.5*((Vn+Fn)*Y-cn),dn+=0.5*((Nn-Ln)*Y-dn),gn+=0.5*((Vn-Fn)*Y-gn),z[16383&pn+3041]=hn,z[16383&pn+6426]=cn,z[16383&pn+10907]=dn,z[pn]=gn,pn=16383&pn+1;var On=Bn+wn+kn+xn+un,In=0>On?-On:On;_n-=G,_n<In&&(_n=In),On/=0.75*_n+0.25,On*=J,d[b]=On,++b,Ae--}this._leadSample=$t,this._leadPeriodA=en,this._leadPeriodB=tn,this._harmonySample=nn,this._harmonyPeriodA=sn,this._harmonyPeriodB=an,this._bassSample=rn,this._bassPeriodA=on,this._bassPeriodB=ln,this._drumSample=un,this._drumPeriod=mn,this._delayPos=pn,this._delayFeedback0=hn,this._delayFeedback1=cn,this._delayFeedback2=dn,this._delayFeedback3=gn,this._limit=_n,this._effectPeriod=R*Zt-Qt>Qt?Math.asin(Zt):Math.PI-Math.asin(Zt),0==this._arpeggioSamples&&(this._arpeggio++,this._arpeggioSamples=q,4==this._arpeggio&&(this._arpeggio=0,this._part++,this._part==this.song.parts&&(this._part=0,this._beat++,this._beat==this.song.beats&&(this._beat=0,this._effectPeriod=0,this._bar++,this._bar<this.song.loopStart?!this.enableIntro&&(this._bar=this.song.loopStart):this.enableIntro=!1,this._bar>=this.song.loopStart+this.song.loopLength&&(0<this.loopCount&&this.loopCount--,(0<this.loopCount||!this.enableOutro)&&(this._bar=this.song.loopStart)),this._bar>=this.song.bars&&(this._bar=0,this.enableIntro=!0,U=!0,this.pause()),Ce()))))}this.stutterPressed&&v(),this._playhead=(((this._arpeggio+1-this._arpeggioSamples/q)/4+this._part)/this.song.parts+this._beat)/this.song.beats+this._bar},c.prototype._frequencyFromPitch=function(d){return 440*Math.pow(2,(d-69)/12)},c.prototype._volumeConversion=function(d){return Math.pow(d/3,1.5)},c.prototype._getSamplesPerArpeggio=function(){if(null==this.song)return 0;var d=this.song.getBeatsPerMinute(),_=d/60*this.song.parts;return Math.floor(this.samplesPerSecond/(4*_))},c}();e.Synth=h})(beepbox||(beepbox={}));
